---
- name: 'Configure | Delete a NFTables Conf File'
  ansible.builtin.file:
    name: '{{ item.dest | mandatory | havlasme.ansible.abspath(nftables__confdir) }}'
    state: 'absent'
  loop: '{{ nftables__conf | selectattr("state", "havlasme.ansible.is_absent") | list }}'
  loop_control:
    label: '{{ item.dest | mandatory }}'
  notify:
  - 'NFTables | Validate Conf and Reload Service'
  when:
  - nftables__state != 'absent'

- name: 'Configure | Create or Update a NFTables Conf File'
  ansible.builtin.template:
    dest: '{{ item.dest | mandatory | havlasme.ansible.abspath(nftables__confdir) }}'
    src: '{{ item.tmpl | d(nftables__conf_template) }}'
    owner: '{{ item.user | d("root") }}'
    group: '{{ item.group | d("root") }}'
    mode: '{{ item.mode | d("0600") }}'
    validate: nft -c -f %s
  loop: '{{ nftables__conf | selectattr("state", "havlasme.ansible.is_present") | list }}'
  loop_control:
    label: '{{ item.dest | mandatory }}'
  notify:
  - 'NFTables | Validate Conf and Reload Service'
  when:
  - nftables__state != 'absent'
...
